<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Notes &amp; Nullifiers - Aztec Connect</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/css/style.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');
                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }
                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Intro</a></li><li class="chapter-item expanded affix "><li class="part-title">Other</li><li class="chapter-item expanded "><a href="primitives.html"><strong aria-hidden="true">2.</strong> Primitives</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="schnorr.html"><strong aria-hidden="true">2.1.</strong> Schnorr Signatures</a></li><li class="chapter-item expanded "><a href="uint.html"><strong aria-hidden="true">2.2.</strong> Unsigned integers</a></li></ol></li><li class="chapter-item expanded "><a href="notes_and_nullifiers.html" class="active"><strong aria-hidden="true">3.</strong> Notes & Nullifiers</a></li><li class="chapter-item expanded "><a href="defi_bridge_interface.html"><strong aria-hidden="true">4.</strong> Defi Bridge Interface</a></li><li class="chapter-item expanded affix "><li class="part-title">'App' Circuits</li><li class="chapter-item expanded "><a href="account_circuit.html"><strong aria-hidden="true">5.</strong> Account Circuit</a></li><li class="chapter-item expanded "><a href="join_split_circuit.html"><strong aria-hidden="true">6.</strong> Join-Split Circuit</a></li><li class="chapter-item expanded "><a href="claim_circuit.html"><strong aria-hidden="true">7.</strong> Claim Circuit</a></li><li class="chapter-item expanded affix "><li class="part-title">Rollup Circuits</li><li class="chapter-item expanded "><a href="rollup_circuit.html"><strong aria-hidden="true">8.</strong> Rollup Circuit</a></li><li class="chapter-item expanded "><a href="root_rollup_circuit.html"><strong aria-hidden="true">9.</strong> Root Rollup Circuit</a></li><li class="chapter-item expanded "><a href="root_verifier_circuit.html"><strong aria-hidden="true">10.</strong> Root Verifier Circuit</a></li><li class="chapter-item expanded affix "><li class="part-title">Contracts</li><li class="chapter-item expanded "><a href="rollup_contract.html"><strong aria-hidden="true">11.</strong> Rollup Contract</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Aztec Connect</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="notes-and-nullifiers"><a class="header" href="#notes-and-nullifiers">Notes and Nullifiers</a></h1>
<h2 id="global-constants"><a class="header" href="#global-constants">Global Constants</a></h2>
<p>See <a href="../../barretenberg/src/aztec/rollup/proofs/notes/constants.hpp">constants.hpp</a> and <a href="../../barretenberg/src/aztec/rollup/constants.hpp">constants.hpp</a> for constants.</p>
<h2 id="pedersen-background"><a class="header" href="#pedersen-background">Pedersen background</a></h2>
<p>A note on pedersen hashing.</p>
<ul>
<li><code>pedersen::commit</code> returns a point.</li>
<li><code>pedersen::compress</code> returns the x-coordinate of <code>pedersen::commit</code>.</li>
</ul>
<p>A different generator is used for each type of note and nullifier (including different generators for partial vs complete commitments). See the hackmd https://hackmd.io/gRsmqUGkSDOCI9O22qWXBA?view for a detailed description of pedersen hashing using turbo plonk.</p>
<p>Note: <code>pedersen::compress</code> is collision resistant (see the large comment above the <code>hash_single</code> function in the codebase, see the hackmd https://hackmd.io/urZOnB1gQimMqsMdf7ZBvw for a formal proof), so this can be used in place of <code>pedersen::commit</code> for note commitments &amp; nullifiers.</p>
<h2 id="notes-and-commitments"><a class="header" href="#notes-and-commitments">Notes and Commitments</a></h2>
<h3 id="account-note"><a class="header" href="#account-note">Account note</a></h3>
<p>An <strong>Account Note</strong> associates a spending key with an account. It consists of the following field elements. See the dedicated <a href="./account_circuit.html">account_circuit.md</a> for more details.</p>
<ul>
<li><code>alias_hash</code>: the 224 bit <code>alias_hash</code></li>
<li><code>account_public_key.x</code>: the x-coordinate of the account public key</li>
<li><code>spending_public_key.x</code>: the x-coordinate of the spending key that is been assigned to this account via this note.</li>
</ul>
<p>An account note commitment is:</p>
<ul>
<li><code>pedersen::compress(alias_hash, account_public_key.x, signing_pub_key.x)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>ACCOUNT_NOTE_COMMITMENT</code></li>
</ul>
</li>
</ul>
<h3 id="value-note"><a class="header" href="#value-note">Value note</a></h3>
<p>Consists of the following:</p>
<ul>
<li><code>secret</code>: a random value to hide the contents of the
commitment.</li>
<li><code>owner.x</code> and <code>owner.y</code>: the public key of the owner of the value note. This is a Grumpkin point.</li>
<li><code>account_required</code>: Is the note linked to an existing account or can the note be spent without an account, by directly signing with the owner key</li>
<li><code>creator_pubkey</code>: Optional. Allows the sender of a value note to inform the recipient who the note came from.</li>
<li><code>value</code>: the value contained in this note.</li>
<li><code>asset_id</code>: unique identifier for the 'currency' of this note. The RollupProcessor.sol maps asset_id's with either ETH or the address of some ERC-20 contract.</li>
<li><code>input_nullifier</code>: In order to create a value note, another value note must be nullified (except when depositing, where a 'gibberish' nullifier is generated). We include the <code>input_nullifier</code> here to ensure the commitment is unique (which, in turn, will ensure this note's nullifier will be unique).</li>
</ul>
<p><strong>partial commitment</strong></p>
<ul>
<li><code>pedersen::compress(secret, owner.x, owner.y, account_required, creator_pubkey)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>VALUE_NOTE_PARTIAL_COMMITMENT</code></li>
<li><code>creator_pubkey</code> can be zero.</li>
</ul>
</li>
</ul>
<blockquote>
<p><em>Note:</em> The <code>secret</code> is to construct a hiding Pedersen commitment to hide the note details.</p>
</blockquote>
<p><strong>complete commitment</strong></p>
<ul>
<li><code>pedersen::compress(value_note_partial_commitment, value, asset_id, input_nullifier)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>VALUE_NOTE_COMMITMENT</code></li>
<li><code>value</code> and <code>asset_id</code> can be zero</li>
</ul>
</li>
</ul>
<p>In other words:</p>
<p><span class="katex-display"><span class="katex"><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.0200000000000005em;vertical-align:-1.2600000000000002em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7600000000000002em;"><span style="top:-3.7600000000000002em;"><span class="pstrut" style="height:2.85em;"></span><span class="mord"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.85em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2600000000000002em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7600000000000002em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mm</span><span class="mopen">(</span><span class="mord text"><span class="mord">ValueNote</span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="delimsizing size1">(</span></span><span class="mopen">[(</span><span class="mord text"><span class="mord">note.secret</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.owner.x</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.owner.y</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.account-required</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.creator-pubkey</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.value</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.asset-id</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord">note.input-nullifier</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="delimsizing size1">)</span></span><span class="mord">.</span><span class="mord mathnormal">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2600000000000002em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.7600000000000002em;"><span style="top:-3.7600000000000002em;"><span class="pstrut" style="height:2.85em;"></span><span class="eqn-num"></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:2.85em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2600000000000002em;"><span></span></span></span></span></span></span></span></span></p>
<p>(The generator indexing is just for illustration. Consult the code.)</p>
<h3 id="claim-note"><a class="header" href="#claim-note">Claim note</a></h3>
<p>Claim notes are created to document the amount a user deposited in the first stage of a defi interaction. Whatever the output token values of the defi interaction, the data in the claim note will allow the correct share to be apportioned to the user. See the <a href="./claim_circuit.html">claim circuit doc</a> for more details.</p>
<p>Consists of the following:</p>
<ul>
<li><code>deposit_value</code>: The value that the user deposited in the first stage of their defi interaction.</li>
<li><code>bridge_call_data</code>: Contains an encoding of the bridge being interacted with.</li>
<li><code>value_note_partial_commitment</code>: See the above 'value note' section.</li>
<li><code>input_nullifier</code>: In order to create a claim note, a value note must be nullified as part of the 'defi deposit' join-split transaction. We include that <code>input_nullifier</code> here to ensure the claim commitment is unique (which, in turn, will ensure this note's nullifier will be unique).</li>
<li><code>defi_interaction_nonce</code>: A unique identifier for a particular defi interaction that took place. This is assigned by the RollupProcessor.sol contract, and emitted as an event.</li>
<li><code>fee</code>: The fee to be paid to the rollup processor, specified as part of the defi deposit join-split tx. Half gets paid to process the defi deposit tx, and half to process the later claim tx.</li>
</ul>
<p><strong>partial commitment</strong></p>
<ul>
<li><code>pedersen::compress(deposit_value, bridge_call_data, value_note_partial_commitment, input_nullifier)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>CLAIM_NOTE_PARTIAL_COMMITMENT</code></li>
<li><code>bridge_call_data</code> can be zero.</li>
</ul>
</li>
</ul>
<p><strong>complete commitment</strong></p>
<ul>
<li><code>pedersen::compress(claim_note_partial_commitment, defi_interaction_nonce, fee)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>CLAIM_NOTE_COMMITMENT</code></li>
<li><code>fee</code> and <code>defi_interaction_nonce</code> could be zero.</li>
</ul>
</li>
</ul>
<h3 id="defi-interaction-note"><a class="header" href="#defi-interaction-note">Defi Interaction note</a></h3>
<p>A defi interaction note records the details of a particular defi interaction. It records the total deposited by all users and the totals output by the defi bridge. These totals get apportioned to each user based on the contents of each user's claim note.</p>
<p>Consists of the following:</p>
<ul>
<li><code>bridge_call_data</code>: Contains an encoding of the bridge that was interacted with.</li>
<li><code>total_input_value</code>: The total deposited to the bridge by all users who took part in this defi interaction.</li>
<li><code>total_output_value_a</code>: The sum returned by the defi bridge denominated in 'token A'. (The details of 'token A' are contained in the <code>bridge_call_data</code>).</li>
<li><code>total_output_value_b</code>: The sum returned by the defi bridge denominated in 'token B'. (The details of 'token B' are contained in the <code>bridge_call_data</code>).</li>
<li><code>interaction_nonce</code>: (a.k.a. defi interaction nonce) A unique identifier for a particular defi interaction that took place. This is assigned by the RollupProcessor.sol contract, and emitted as an event.</li>
<li><code>interaction_result</code>: true/false - was the L1 transaction a success?</li>
</ul>
<p><strong>commitment</strong></p>
<ul>
<li><code>pedersen::compress(bridge_call_data, total_input_value, total_output_value_a, total_output_value_b, interaction_nonce, interaction_result)</code>
<ul>
<li>Pedersen GeneratorIndex: <code>DEFI_INTERACTION_NOTE_COMMITMENT</code></li>
</ul>
</li>
</ul>
<h1 id="note-encryption-and-decryption"><a class="header" href="#note-encryption-and-decryption">Note encryption and decryption</a></h1>
<p>Details on this are found <a href="https://hackmd.io/@aztec-network/BJKHah_4d">here</a></p>
<h1 id="nullifiers"><a class="header" href="#nullifiers">Nullifiers</a></h1>
<h2 id="value-note-nullifier"><a class="header" href="#value-note-nullifier">Value note nullifier</a></h2>
<p><strong>Objectives</strong> of this nullifier:</p>
<ul>
<li>Only the owner of a note may be able to produce the note's nullifier.</li>
<li>No collisions. Each nullifier can only be produced for one value note commitment. Duplicate nullifiers must not be derivable from different note commitments.</li>
<li>No collisions between nullifiers of other notes (i.e. claim notes or defi interaction notes).</li>
<li>No double-spending. Each commitment must have one, and only one, nullifier.</li>
<li>The nullifier must only be accepted and added to the nullifier tree if it is the output of a join-split circuit which 'spends' the corresponding note.</li>
</ul>
<p><strong>Calculation</strong>
We set out the computation steps below, with suggestions for changes:</p>
<ul>
<li><code>hashed_pk = account_private_key * G</code> (where <code>G</code> is a generator unique to this operation).
<ul>
<li>This <code>hashed_pk</code> is useful to demonstrate to a 3rd party that you've nullified something without having to provide your secret key.</li>
</ul>
</li>
<li><code>compressed_inputs = pedersen::compress(value_note_commitment, hashed_pk.x, hashed_pk.y, is_real_note)</code>
<ul>
<li>This compression step reduces the cost (constrain-wise) of the blake2s hash which is done next.</li>
</ul>
</li>
<li><code>nullifier = blake2s(compressed_inputs);</code>
<ul>
<li>blake2s is needed, because a pedersen commitment alone can leak data (see comment in the code for more details on this).</li>
</ul>
</li>
</ul>
<p>Pedersen GeneratorIndex:</p>
<ul>
<li><code>JOIN_SPLIT_NULLIFIER_ACCOUNT_PRIVATE_KEY</code> for the hashed_pk</li>
<li><code>JOIN_SPLIT_NULLIFIER</code> to compress the inputs</li>
</ul>
<h2 id="claim-note-nullifier"><a class="header" href="#claim-note-nullifier">Claim note nullifier</a></h2>
<p><strong>Objectives</strong> of this nullifier:</p>
<ul>
<li>Anyone (notably the rollup provider) may be able to produce this nullifier.</li>
<li>No collisions. Each nullifier can only be produced for one claim note commitment. Duplicate nullifiers must not be derivable from different claim note commitments.</li>
<li>No collisions between nullifiers of other notes (i.e. value notes or defi interaction notes).</li>
<li>This nullifier must only be added to the nullifier tree if it is the output of a claim circuit which 'spends' the corresponding claim note.</li>
<li>No double-spending. Each claim note commitment must have one, and only one, nullifier.</li>
</ul>
<p><strong>Calculation</strong></p>
<ul>
<li><code>nullifier = pedersen::compress(claim_note_commitment);</code>
<ul>
<li>Note: it is ok that observers can see which claim note is being nullified, since values in a defi interaction are public (only owners are private). Furthermore, the rollup priovider needs to be able to generate the claim proof and doesn't have access to any user secrets - so this nullifier allows this use case.</li>
<li>Pedersen GeneratorIndex:<code>CLAIM_NOTE_NULLIFIER</code></li>
</ul>
</li>
</ul>
<h2 id="defi-interaction-nullifier"><a class="header" href="#defi-interaction-nullifier">Defi Interaction nullifier</a></h2>
<p><strong>Objectives</strong> of this nullifier:</p>
<ul>
<li>This is not a 'conventional' nullifier, in the sense that it doesn't prevent others from 'referring' to the defi interaction note. It's really only needed so that <em>something</em> unique may be fed into the <code>output_note_2</code> output of the claim circuit.</li>
<li>Anyone (notably the rollup provider) may be able to produce a valid nullifier on behalf of any user who partook in the corresponding defi interaction.</li>
<li>No collisions between nullifiers of other notes (i.e. value notes or claim notes).</li>
<li>This nullifier must only be added to the nullifier tree if it is the output of a claim circuit which 'refers' the corresponding defi interaction note note and 'spends' a claim note which was created during that defi interaction.</li>
</ul>
<p><strong>Calculation:</strong></p>
<ul>
<li><code>nullifier = pedersen::compress(defi_interaction_note_commitment, claim_note_commitment);</code></li>
<li>Pedersen GeneratorIndex:<code>DEFI_INTERACTION_NULLIFIER</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="uint.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="defi_bridge_interface.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="uint.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="defi_bridge_interface.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="theme/sidebar.js"></script>
    </body>
</html>